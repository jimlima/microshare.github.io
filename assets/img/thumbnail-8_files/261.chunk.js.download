(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["261"],{1417:function(e,t,n){"use strict";var r=n(1515),i=n(1376),s=n(1378),o=n(33),u=n(1371),a=n(53),f=n(14),l=n(711),c=n(1433),h=n(502),p=n(15),d=new RegExp("^Templates$","i"),v=(function(){function e(){}e.isFolder=function(e,t){return t?e&&(e.type===u.e.Folder||e.type===u.e.OneNote):e&&e.type===u.e.Folder};e.isCheckedOut=function(e){return l.e(e)};e.isCheckedOutByUser=function(e,t){return l.n(e,t)};e.isCheckedOutByOther=function(t,n){return e.isCheckedOut(t)&&!e.isCheckedOutByUser(t,n)};e.showCheckedOutByOtherDialog=function(e){return e.requestDialog({title:r.e.FileCheckedoutOrLockedWarningTitle,component:{name:c.e.tagName,params:{text:r.e.FileCheckedoutOrLockedWarning}},actions:[{name:i.e.cancelActionText,execute:function(){return f.n.wrap(2)},icon:new s.e("Cancel"),isDefault:!0}]}).wait().then(function(){return{resultType:o.e.Success}})};e.isPublished=function(t,n){return n.isModerated?t.properties[e.PublishProperty]&&"3"!==t.properties[e.PublishProperty]&&"1"!==t.properties[e.PublishProperty]:0===e.getVersionNoModeration(t,n).minor&&0!==e.getVersionNoModeration(t,n).major};e.needsPublishingReminder=function(t,n){return!e.isPublished(t,n)&&(!(e.isPendingApproval(t,n)||!p.e.isActivated("20638368-710f-41c5-b78b-464db07fb707","04/27/2020","No publishing banner for page templates")&&e.isPageTemplate(t))&&(!(Object(h.isFeatureEnabled)(h.WexSitePagesScheduling)&&t.properties&&t.properties._ScheduledVersion&&t.properties.owshiddenversion===t.properties._ScheduledVersion)&&(a.e.hasItemPermission(t,a.e.editListItems)&&n.enableMinorVersions&&!e.isFolder(t,!0))))};e.isPublishingRelevant=function(t,n){return a.e.hasItemPermission(t,a.e.editListItems)&&n.enableMinorVersions&&!e.isCheckedOut(t)&&!e.isFolder(t,!0)};e.getVersionNoModeration=function(e,t){return t.isModerated?{major:0,minor:0}:this.getVersion(e,t)};e.getVersion=function(t,n){if(t&&t.properties&&t.properties[e.VersionProperty]){var r=Number(t.properties[e.VersionProperty])%512;return{major:Math.floor(Number(t.properties[e.VersionProperty])/512),minor:r}}return{major:0,minor:0}};e.isPendingApproval=function(t,n){return!!n.isModerated&&(t&&t.properties&&t.properties[e.PublishProperty]&&"2"===t.properties[e.PublishProperty])};e.isPageTemplate=function(e){if(!e.id)return!1;var t=e.id.split("/"),n=t.length;return d.test(t[n-2])};e.isApprovalRelevant=function(t,n){return n&&n.isModerated&&!e.isCheckedOut(t)&&a.e.hasItemPermission(t,a.e.editListItems)&&a.e.hasItemPermission(t,a.e.approveItems)};e.FileTypeProperty="FSObjType";e.PublishProperty="_ModerationStatus.";e.VersionProperty="_UIVersion";return e})();t.e=v},1873:function(e,t,n){"use strict";n.d(t,"t",function(){return r});n.d(t,"e",function(){return s});var r,i,s;(function(e){e[e.DownloadSingleFile=0]="DownloadSingleFile";e[e.DownloadMultiFile=1]="DownloadMultiFile";e[e.DownloadFileInZip=2]="DownloadFileInZip"})(r||(r={}));(function(e){e.Files="files";e.Recent="recent";e.Shared="shared";e.RecycleBin="recyclebin";e.Photos="photos";e.Discover="discover"})(i||(i={}));(function(e){e.Navigation="NavigationRequest";e.Click="ClickRequest";e.Search="SearchRequest";e.SearchSuggestionClick="SearchSuggestionClickRequest";e.TokenResponse="TokenResponse";e.TokenRequest="OAuthTokenRequest";e.DarkModeRequest="DarkModeRequest";e.EnableDiscover="EnableDiscoverCommand";e.LokiTokenRequest="LokiTokenRequest";e.SubstrateTokenRequest="SubstrateTokenRequest";e.EnablePersonalVault="EnablePersonalVault"})(s||(s={}))},2793:function(e,t,n){"use strict";var r=n(0),i=(function(e){Object(r.__extends)(t,e);function t(t){return e.call(this,{dataSourceName:"MicroServiceEndPointDataSource"},{pageContext:t})||this}t.prototype.getMicroServiceEndPoints=function(e){var t=this._pageContext.webAbsoluteUrl+"/_api/microservicemanager/getserviceurls?service='"+e+"'";return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results&&e.d.GetServiceUrls.results[0]})};t.prototype.getAllMicroServiceEndPoints=function(e){var t=this._pageContext.webAbsoluteUrl+"/_api/microservicemanager/getserviceurls?service='"+e+"'";return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetAllServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results})};return t})(n(570).t);t.e=i},2853:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(14),s=n(1417),o=n(1661),u=n(87),a=n(1224),f=n(1371),l=n(33),c=n(1383),h=n(259),p=n(2426),d=n(3049),v=n(94),m=n(502),g=n(7),y=n(10),b=n(93),w=n(2480),E=n(1563),S=n(2793),x=n(32),T=(function(e){Object(r.__extends)(t,e);function t(t,n){return e.call(this,n.pageContext)||this}return t})(S.e),N=Object(y.s)("MicroserviceEndPointDataSource.key_5",T,{pageContext:x.h}),C=n(113),k=n(722),L=n(115),A=n(1873),O=new g.t({name:"DownloadExecutor_5",loader:new y.t(function(){return i.n.resolve(n.e("260").then(n.bind(null,3880))).then(function(e){return e.typeResourceKey})})}),M=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n._sessionManagementProvider=n.resources.consume(d.e.optional);n._platform=n.resources.consume(h.e);n._oAuthTokenProvider=n.resources.consume(E.e.optional);n._navigation=n.resources.consume(v.e);n._hiddenDomProvider=n.resources.consume(p.e);n.selectionHelper=t.selectionHelper;n.currentItem=t.currentItem;n.dialogProvider=n.resources.consume(c.e);n.isOneDriveWinApp=Object(C.e)();return n}t.prototype.execute=function(e,t){var n,r=this,s=this.selectionHelper.selection;n={items:s.peek().map(function(e){return e.peek()})};return this.onPreDownloadItems(n.items).then(function(e){if(e){if(r.isOneDriveWinApp){1===n.items.length&&n.items[0].type!==f.e.Folder?r.resources.consumeAsync(u.a).then(function(e){var t=n.items[0];e.getDownloadUrl(t,{downloadType:0}).then(function(e){r.resources.consumeAsync(k.e).then(function(n){var r={command:"Download",type:A.t.DownloadSingleFile,downloadUrl:e,zipFileName:t.displayName};n.sendCommand({command:JSON.stringify({DownloadCommand:r})})})})}):r.resources.consumeAsync(u.a).then(function(e){e.getDownloadZipRequest(n).then(function(e){r.resources.consumeAsync(k.e).then(function(t){t.sendCommand({command:e})})})});return{resultType:l.e.Success}}return r.resources.consumeAsync(u.a).then(function(e){return e.downloadItems(n).then(function(){var e={},t={count:n.items.length};if(1===n.items.length){e.fileType=f.e[n.items[0].type];e.extension=n.items[0].extension||""}return{resultType:l.e.Success,extraData:e,extraMetrics:t}})})}return i.n.wrap({resultType:l.e.ExpectedFailure})})};t.prototype.executeVroomDownload=function(e){var n=this,r=e.itemsData,i=e.docIds,s=e.zipApiUrl,o=e.provider,u=(e.method,e.appId),a=(e.loggingEvent,e.fileDisplayName);if(!(t.doc_ids===i&&Date.now()-t.last_download<5e3)){t.last_download=Date.now();t.doc_ids=i;var f=function(){return n._doDownload(r,i,s,o,null,null,u,a||"")};if(r&&-1!==r[0].docId.indexOf("access_token")||"spo"===o&&this._oAuthTokenProvider)try{return this.resources.consumeAsync(N).then(function(e){return e.getMicroServiceEndPoints("media")}).then(function(e){return n._oAuthTokenProvider.getToken(e,!0)}).then(function(e){return n._doDownload(r,i,s,o,null,e,u,a||"")},f)}catch(e){return f()}return this._sessionManagementProvider.getToken().then(function(e){return n._doDownload(r,i,s,o,e,null,u,a||"")},function(e){if(e instanceof L.e&&"unauthUser"===e.code)return f()})}};t.prototype.onPreDownloadItems=function(e){return i.n.wrap(!0)};t.prototype._doDownload=function(e,t,n,r,i,s,o,u){return e?this._completeDownloadasZip(e,n,r,i,s,o):this._completeDownloadFile(n,i,u)};t.prototype._completeDownloadFile=function(e,t,n){e+=t?"?access_token="+t.accessToken:"";this.isOneDriveWinApp&&this.resources.consumeAsync(k.e).then(function(t){var r={command:"Download",type:A.t.DownloadSingleFile,downloadUrl:e,zipFileName:n};t.sendCommand({command:JSON.stringify({DownloadCommand:r})})});if(this._platform.isMobile){this._navigation.navigateTo({url:e,frameId:"_self"});return i.n.wrap({resultType:l.e.Success})}if(this._platform.isIE){this._downloadForIE("od-download-tab",e);return i.n.wrap({resultType:l.e.Success})}var r=Math.random(),s=this._getDownloadIframe(r);document.body.appendChild(s);s.src=e;this.async.setTimeout(function(){s.remove()},2e4);return i.n.wrap({resultType:l.e.Success})};t.prototype._completeDownloadasZip=function(e,n,r,i,s,o){var u=this;t.zip_count++;var a=b.e.generate(),f="OneDrive_"+t.zip_count+"_"+(new Date).toLocaleDateString().replace(/\//g,"-").replace(/[^ -~]/g,"")+".zip";e&&1===e.length&&(f=e[0].name+".zip");return this.resources.consumeAsync(w.e.optional).then(function(t){var c,h=t&&t.getNotificationUrl()||"";h&&Object(m.isFeatureEnabled)(m.DownloadNotifications)&&u.resources.consumeAsync(O).then(function(e){var t=new e({items:[],guid:a,zipFileName:f});u.trackPromise(t.start());t.wait()});var p=2e4;if(u._platform.isIE){c=u._downloadForIE("od-download-tab");p=5e3}if(u.isOneDriveWinApp){var d={files:JSON.stringify({items:e}),notificationUrlValue:h,guid:a,provider:r,zipFileName:f,oAuthToken:s||"",accessToken:i&&i.accessToken||"",appId:o},v={command:"Download",type:A.t.DownloadMultiFile,downloadUrl:n,zipFileName:f,postBody:JSON.stringify({request:d})};u.resources.consumeAsync(k.e).then(function(e){e.sendCommand({command:JSON.stringify({DownloadCommand:v})})});return{resultType:l.e.Success}}var g=Math.random(),y=u._getDownloadIframe(g),b=u._hiddenDomProvider.requestControl({name:"od-downloadaszip",params:{filesValue:JSON.stringify({items:e}),notificationUrlValue:h,guid:a,formAction:n,providerValue:r,id:g,zipFileName:f,target:u._platform.isIE?"od-download-tab":y.id,oAuthToken:s||"",accessToken:i&&i.accessToken||"",appId:o||"",resources:u.resources}}),w=document.getElementById("form_download_as_zip"+g);w.parentNode.appendChild(y);w.submit();var E=u.addDisposable({dispose:function(){u._hiddenDomProvider.disposeControl(b)}});u.async.setTimeout(function(){E.dispose();c&&c.close()},p);return{resultType:l.e.Success}})};t.prototype._getDownloadIframe=function(e){var t=document.createElement("iframe");t.id="od-download-iframe"+e;t.name=t.id;t.hidden=!0;return t};t.prototype._downloadForIE=function(e,t){void 0===t&&(t="");var n;n=window.open(t,e);this.async.setTimeout(function(){n.close()},5e3);return n};t.zip_count=0;return t})(a.default),_=n(122);Object(_.n)([{rawString:".od-DownloadAsZip{visibility:hidden}"}]);var D=(function(e){Object(r.__extends)(t,e);function t(t){var n=e.call(this,t)||this;n.formAction=t.formAction;n.filesValue=t.filesValue;n.providerValue=t.providerValue;n.id="form_download_as_zip"+t.id;n.notificationUrlValue=t.notificationUrlValue;n.accessToken=t.accessToken;n.zipFileName=t.zipFileName;n.target=t.target;n.oAuthToken=t.oAuthToken;n.guid=t.guid;n.method=t.method||"Post";n.appId=t.appId;return n}return t})(n(1361).t),P=(n(1363).e({tagName:"od-downloadaszip",template:'<div id="od-Download-As-Zip" class="od-DownloadAsZip"><form class="DownloadAsZipForm" name="form_download_as_zip" data-bind="attr:{action:formAction,target:target,id:id,method:method}"><input id="download_input_1" name="provider" type="hidden" data-bind="value:providerValue"><input id="download_input_2" name="guid" type="hidden" data-bind="value:guid"><input id="download_input_3" name="files" type="hidden" data-bind="value:filesValue"><input id="download_input_4" name="notificationUrl" type="hidden" data-bind="value:notificationUrlValue"><input id="download_input_5" name="accessToken" type="hidden" data-bind="value:accessToken"><input id="download_input_6" name="zipFileName" type="hidden" data-bind="value:zipFileName"><input id="download_input_7" name="oAuthToken" type="hidden" data-bind="value:oAuthToken"><input id="download_input_8" name="appId" type="hidden" data-bind="value:appId"></form></div>',viewModel:D,synchronous:!0}),n(121)),H=(function(e){Object(r.__extends)(t,e);function t(t){return e.call(this,t)||this}t.prototype.execute=function(t,n){var r=this,a=this.selectionHelper.selection.peek();n.data.extraData||(n.data.extraData={});return a.length>1||s.e.isFolder(a[0].peek(),!1)?this.resources.consumeAsync(u.b).then(function(t){var u="",l=0,c=0,h=Object(m.isFeatureEnabled)(m.MediaTAUseVroomV21),p=a.map(function(e){if(e){var n=e.peek(),r=n.urls[o.t.itemUrl];u+=r;n.type===f.e.OneNote&&l++;var i=s.e.isFolder(n,!1);i&&c++;var a=t.getAccessToken(n,{apiVersion:h?"v2.1":"v2.0"});return{name:n.name,size:n.size,docId:r+(-1!==r.indexOf("?")?"&":"?")+"access_token="+a.accessToken,isFolder:i}}});if(!p)return i.n.wrapError(new Error("No item metadata for download."));p=p.filter(Boolean);P.e(n.data.extraData,{oneNotesCount:l,filesCount:a.length-c,foldersCount:c});var d=a[0].peek().urls[o.t.downloadAsZip];return e.prototype.executeVroomDownload.call(r,{itemsData:p,docIds:u,zipApiUrl:d,provider:"spo",method:"POST",appId:"",loggingEvent:n})}):e.prototype.execute.call(this,t,n)};return t})(M);t.default=H}}]);