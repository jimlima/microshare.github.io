/*! For license information please see undefined.LICENSE.txt */
(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([["116"],{3790:function(e,t,n){var r=(function(){"use strict";r=function(e){this.REQUEST_TYPE={LOGIN:"LOGIN",RENEW_TOKEN:"RENEW_TOKEN",UNKNOWN:"UNKNOWN"};this.RESPONSE_TYPE={ID_TOKEN_TOKEN:"id_token token",TOKEN:"token"};this.CONSTANTS={ACCESS_TOKEN:"access_token",EXPIRES_IN:"expires_in",ID_TOKEN:"id_token",ERROR_DESCRIPTION:"error_description",SESSION_STATE:"session_state",ERROR:"error",STORAGE:{TOKEN_KEYS:"adal.token.keys",ACCESS_TOKEN_KEY:"adal.access.token.key",EXPIRATION_KEY:"adal.expiration.key",STATE_LOGIN:"adal.state.login",STATE_RENEW:"adal.state.renew",NONCE_IDTOKEN:"adal.nonce.idtoken",SESSION_STATE:"adal.session.state",USERNAME:"adal.username",IDTOKEN:"adal.idtoken",ERROR:"adal.error",ERROR_DESCRIPTION:"adal.error.description",LOGIN_REQUEST:"adal.login.request",LOGIN_ERROR:"adal.login.error",RENEW_STATUS:"adal.token.renew.status",ANGULAR_LOGIN_REQUEST:"adal.angular.login.request"},RESOURCE_DELIMETER:"|",CACHE_DELIMETER:"||",LOADFRAME_TIMEOUT:6e3,TOKEN_RENEW_STATUS_CANCELED:"Canceled",TOKEN_RENEW_STATUS_COMPLETED:"Completed",TOKEN_RENEW_STATUS_IN_PROGRESS:"In Progress",LOGGING_LEVEL:{ERROR:0,WARN:1,INFO:2,VERBOSE:3},LEVEL_STRING_MAP:{0:"ERROR:",1:"WARNING:",2:"INFO:",3:"VERBOSE:"},POPUP_WIDTH:483,POPUP_HEIGHT:600};if(r.prototype._singletonInstance)return r.prototype._singletonInstance;r.prototype._singletonInstance=this;this.instance="https://login.microsoftonline.com/";this.config={};this.callback=null;this.popUp=!1;this.isAngular=!1;this._user=null;this._activeRenewals={};this._loginInProgress=!1;this._acquireTokenInProgress=!1;this._renewStates=[];this._callBackMappedToRenewStates={};this._callBacksMappedToRenewStates={};this._openedWindows=[];this._requestType=this.REQUEST_TYPE.LOGIN;window._adalInstance=this;if(e.displayCall&&"function"!=typeof e.displayCall)throw new Error("displayCall is not a function");if(!e.clientId)throw new Error("clientId is required");this.config=this._cloneConfig(e);void 0===this.config.navigateToLoginRequestUrl&&(this.config.navigateToLoginRequestUrl=!0);this.config.popUp&&(this.popUp=!0);this.config.callback&&"function"==typeof this.config.callback&&(this.callback=this.config.callback);this.config.instance&&(this.instance=this.config.instance);this.config.loginResource||(this.config.loginResource=this.config.clientId);this.config.redirectUri||(this.config.redirectUri=window.location.href.split("?")[0].split("#")[0]);this.config.postLogoutRedirectUri||(this.config.postLogoutRedirectUri=window.location.href.split("?")[0].split("#")[0]);this.config.anonymousEndpoints||(this.config.anonymousEndpoints=[]);this.config.isAngular&&(this.isAngular=this.config.isAngular);this.config.loadFrameTimeout&&(this.CONSTANTS.LOADFRAME_TIMEOUT=this.config.loadFrameTimeout)};"undefined"!=typeof window&&(window.Logging={level:0,log:function(e){}});r.prototype.login=function(){if(this._loginInProgress)this.info("Login in progress");else{this._loginInProgress=!0;var e=this._guid();this.config.state=e;this._idTokenNonce=this._guid();var t=this._getItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST);t&&""!==t?this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,""):t=window.location.href;this.verbose("Expected state: "+e+" startPage:"+t);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,t);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,e,!0);this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0);this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var n=this._getNavigateUrl("id_token",null)+"&nonce="+encodeURIComponent(this._idTokenNonce);if(this.config.displayCall)this.config.displayCall(n);else if(this.popUp){this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,"");this._renewStates.push(e);this.registerCallback(e,this.config.clientId,this.callback);this._loginPopup(n)}else this.promptUser(n)}};r.prototype._openPopup=function(e,t,n,r){try{var i=window.screenLeft?window.screenLeft:window.screenX,s=window.screenTop?window.screenTop:window.screenY,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,u=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,a=o/2-n/2+i,f=u/2-r/2+s,l=window.open(e,t,"width="+n+", height="+r+", top="+f+", left="+a);l.focus&&l.focus();return l}catch(e){this.warn("Error opening popup, "+e.message);this._loginInProgress=!1;this._acquireTokenInProgress=!1;return null}};r.prototype._handlePopupError=function(e,t,n,r,i){this.warn(r);this._saveItem(this.CONSTANTS.STORAGE.ERROR,n);this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,r);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,i);t&&this._activeRenewals[t]&&(this._activeRenewals[t]=null);this._loginInProgress=!1;this._acquireTokenInProgress=!1;e&&e(r,null,n)};r.prototype._loginPopup=function(e,t,n){var r=this._openPopup(e,"login",this.CONSTANTS.POPUP_WIDTH,this.CONSTANTS.POPUP_HEIGHT),i=n||this.callback;if(null!=r){this._openedWindows.push(r);if(-1!=this.config.redirectUri.indexOf("#"))var s=this.config.redirectUri.split("#")[0];else s=this.config.redirectUri;var o=this,u=window.setInterval(function(){if(r&&!r.closed&&void 0!==r.closed)try{var e=r.location;if(-1!=encodeURI(e.href).indexOf(encodeURI(s))){o.isAngular?o._broadcast("adal:popUpHashChanged",e.hash):o.handleWindowCallback(e.hash);window.clearInterval(u);o._loginInProgress=!1;o._acquireTokenInProgress=!1;o.info("Closing popup window");o._openedWindows=[];r.close();return}}catch(e){}else{var n="Popup Window closed",a="Popup Window closed by UI action/ Popup Window handle destroyed due to cross zone navigation in IE/Edge";o.isAngular&&o._broadcast("adal:popUpClosed",a+o.CONSTANTS.RESOURCE_DELIMETER+n);o._handlePopupError(i,t,n,a,a);window.clearInterval(u)}},1)}else{var a="Popup Window is null. This can happen if you are using IE";this._handlePopupError(i,t,"Error opening popup",a,a)}};r.prototype._broadcast=function(e,t){(function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail);return n}e.prototype=window.Event.prototype;window.CustomEvent=e})();var n=new CustomEvent(e,{detail:t});window.dispatchEvent(n)};r.prototype.loginInProgress=function(){return this._loginInProgress};r.prototype._hasResource=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);return t&&!this._isEmpty(t)&&t.indexOf(e+this.CONSTANTS.RESOURCE_DELIMETER)>-1};r.prototype.getCachedToken=function(e){if(!this._hasResource(e))return null;var t=this._getItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e),n=this._getItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e),r=this.config.expireOffsetSeconds||300;if(n&&n>this._now()+r)return t;this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,"");this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0);return null};r.prototype.getCachedUser=function(){if(this._user)return this._user;var e=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);this._user=this._createUser(e);return this._user};r.prototype.registerCallback=function(e,t,n){this._activeRenewals[t]=e;this._callBacksMappedToRenewStates[e]||(this._callBacksMappedToRenewStates[e]=[]);var r=this;this._callBacksMappedToRenewStates[e].push(n);this._callBackMappedToRenewStates[e]||(this._callBackMappedToRenewStates[e]=function(n,i,s,o){r._activeRenewals[t]=null;for(var u=0;u<r._callBacksMappedToRenewStates[e].length;++u)try{r._callBacksMappedToRenewStates[e][u](n,i,s,o)}catch(s){r.warn(s)}r._callBacksMappedToRenewStates[e]=null;r._callBackMappedToRenewStates[e]=null})};r.prototype._renewToken=function(e,t,n){this.info("renewToken is called for resource:"+e);var r=this._addAdalFrame("adalRenewFrame"+e),i=this._guid()+"|"+e;this.config.state=i;this._renewStates.push(i);this.verbose("Renew token Expected state: "+i);n=n||"token";var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl(n,e),"prompt");if(n===this.RESPONSE_TYPE.ID_TOKEN_TOKEN){this._idTokenNonce=this._guid();this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0);s+="&nonce="+encodeURIComponent(this._idTokenNonce)}s+="&prompt=none";s=this._addHintParameters(s);this.registerCallback(i,e,t);this.verbose("Navigate to:"+s);r.src="about:blank";this._loadFrameTimeout(s,"adalRenewFrame"+e,e)};r.prototype._renewIdToken=function(e,t){this.info("renewIdToken is called");var n=this._addAdalFrame("adalIdTokenFrame"),r=this._guid()+"|"+this.config.clientId;this._idTokenNonce=this._guid();this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,this._idTokenNonce,!0);this.config.state=r;this._renewStates.push(r);this.verbose("Renew Idtoken Expected state: "+r);var i=null==t?null:this.config.clientId,s=(t=t||"id_token",this._urlRemoveQueryStringParameter(this._getNavigateUrl(t,i),"prompt"));s+="&prompt=none";s=this._addHintParameters(s);s+="&nonce="+encodeURIComponent(this._idTokenNonce);this.registerCallback(r,this.config.clientId,e);this.verbose("Navigate to:"+s);n.src="about:blank";this._loadFrameTimeout(s,"adalIdTokenFrame",this.config.clientId)};r.prototype._urlContainsQueryStringParameter=function(e,t){return new RegExp("[\\?&]"+e+"=").test(t)};r.prototype._urlRemoveQueryStringParameter=function(e,t){var n=new RegExp("(\\&"+t+"=)[^&]+");e=e.replace(n,"");n=new RegExp("("+t+"=)[^&]+&");e=e.replace(n,"");n=new RegExp("("+t+"=)[^&]+");return e=e.replace(n,"")};r.prototype._loadFrameTimeout=function(e,t,n){this.verbose("Set loading state to pending for: "+n);this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+n,this.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS);this._loadFrame(e,t);var r=this;setTimeout(function(){if(r._getItem(r.CONSTANTS.STORAGE.RENEW_STATUS+n)===r.CONSTANTS.TOKEN_RENEW_STATUS_IN_PROGRESS){r.verbose("Loading frame has timed out after: "+r.CONSTANTS.LOADFRAME_TIMEOUT/1e3+" seconds for resource "+n);var e=r._activeRenewals[n];e&&r._callBackMappedToRenewStates[e]&&r._callBackMappedToRenewStates[e]("Token renewal operation failed due to timeout",null,"Token Renewal Failed");r._saveItem(r.CONSTANTS.STORAGE.RENEW_STATUS+n,r.CONSTANTS.TOKEN_RENEW_STATUS_CANCELED)}},r.CONSTANTS.LOADFRAME_TIMEOUT)};r.prototype._loadFrame=function(e,t){var n=this;n.info("LoadFrame: "+t);var r=t;setTimeout(function(){var t=n._addAdalFrame(r);if(""===t.src||"about:blank"===t.src){t.src=e;n._loadFrame(e,r)}},500)};r.prototype.acquireToken=function(e,t){if(this._isEmpty(e)){this.warn("resource is required");t("resource is required",null,"resource is required")}else{var n=this.getCachedToken(e);if(n){this.info("Token is already in cache for resource:"+e);t(null,n,null)}else if(this._user||this.config.extraQueryParameter&&-1!==this.config.extraQueryParameter.indexOf("login_hint"))if(this._activeRenewals[e])this.registerCallback(this._activeRenewals[e],e,t);else{this._requestType=this.REQUEST_TYPE.RENEW_TOKEN;if(e===this.config.clientId)if(this._user){this.verbose("renewing idtoken");this._renewIdToken(t)}else{this.verbose("renewing idtoken and access_token");this._renewIdToken(t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)}else if(this._user){this.verbose("renewing access_token");this._renewToken(e,t)}else{this.verbose("renewing idtoken and access_token");this._renewToken(e,t,this.RESPONSE_TYPE.ID_TOKEN_TOKEN)}}else{this.warn("User login is required");t("User login is required",null,"login required")}}};r.prototype.acquireTokenPopup=function(e,t,n,r){if(this._isEmpty(e)){this.warn("resource is required");r("resource is required",null,"resource is required")}else if(this._user)if(this._acquireTokenInProgress){this.warn("Acquire token interactive is already in progress");r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress")}else{var i=this._guid()+"|"+e;this.config.state=i;this._renewStates.push(i);this._requestType=this.REQUEST_TYPE.RENEW_TOKEN;this.verbose("Renew token Expected state: "+i);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");s+="&prompt=select_account";t&&(s+=encodeURIComponent(t));if(n&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(n);else if(n&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s);this._acquireTokenInProgress=!0;this.info("acquireToken interactive is called for the resource "+e);this.registerCallback(i,e,r);this._loginPopup(s,e,r)}else{this.warn("User login is required");r("User login is required",null,"login required")}};r.prototype.acquireTokenRedirect=function(e,t,n){if(this._isEmpty(e)){this.warn("resource is required");r("resource is required",null,"resource is required")}else{var r=this.callback;if(this._user)if(this._acquireTokenInProgress){this.warn("Acquire token interactive is already in progress");r("Acquire token interactive is already in progress",null,"Acquire token interactive is already in progress")}else{var i=this._guid()+"|"+e;this.config.state=i;this.verbose("Renew token Expected state: "+i);var s=this._urlRemoveQueryStringParameter(this._getNavigateUrl("token",e),"prompt");s+="&prompt=select_account";t&&(s+=encodeURIComponent(t));if(n&&-1===s.indexOf("&claims"))s+="&claims="+encodeURIComponent(n);else if(n&&-1!==s.indexOf("&claims"))throw new Error("Claims cannot be passed as an extraQueryParameter");s=this._addHintParameters(s);this._acquireTokenInProgress=!0;this.info("acquireToken interactive is called for the resource "+e);this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,window.location.href);this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,i,!0);this.promptUser(s)}else{this.warn("User login is required");r("User login is required",null,"login required")}}};r.prototype.promptUser=function(e){if(e){this.info("Navigate to:"+e);window.location.replace(e)}else this.info("Navigate url is empty")};r.prototype.clearCache=function(){this._saveItem(this.CONSTANTS.STORAGE.LOGIN_REQUEST,"");this._saveItem(this.CONSTANTS.STORAGE.ANGULAR_LOGIN_REQUEST,"");this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,"");this._saveItem(this.CONSTANTS.STORAGE.STATE_LOGIN,"");this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,"");this._renewStates=[];this._saveItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN,"");this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"");var e=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS);if(!this._isEmpty(e)){e=e.split(this.CONSTANTS.RESOURCE_DELIMETER);for(var t=0;t<e.length&&""!==e[t];t++){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e[t],"");this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e[t],0)}}this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,"")};r.prototype.clearCacheForResource=function(e){this._saveItem(this.CONSTANTS.STORAGE.STATE_RENEW,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");if(this._hasResource(e)){this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+e,"");this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+e,0)}};r.prototype.logOut=function(){this.clearCache();this._user=null;var e;if(this.config.logOutUri)e=this.config.logOutUri;else{var t="common",n="";this.config.tenant&&(t=this.config.tenant);this.config.postLogoutRedirectUri&&(n="post_logout_redirect_uri="+encodeURIComponent(this.config.postLogoutRedirectUri));e=this.instance+t+"/oauth2/logout?"+n}this.info("Logout navigate to: "+e);this.promptUser(e)};r.prototype._isEmpty=function(e){return void 0===e||!e||0===e.length};r.prototype.getUser=function(e){if("function"!=typeof e)throw new Error("callback is not a function");if(this._user)e(null,this._user);else{var t=this._getItem(this.CONSTANTS.STORAGE.IDTOKEN);if(this._isEmpty(t)){this.warn("User information is not available");e("User information is not available",null)}else{this.info("User exists in cache: ");this._user=this._createUser(t);e(null,this._user)}}};r.prototype._addHintParameters=function(e){if(this._user&&this._user.profile&&this._user.profile.hasOwnProperty("upn")){this._urlContainsQueryStringParameter("login_hint",e)||(e+="&login_hint="+encodeURIComponent(this._user.profile.upn));if(!this._urlContainsQueryStringParameter("domain_hint",e)&&this._user.profile.upn.indexOf("@")>-1){var t=this._user.profile.upn.split("@");e+="&domain_hint="+encodeURIComponent(t[t.length-1])}}return e};r.prototype._createUser=function(e){var t=null,n=this._extractIdToken(e);if(n&&n.hasOwnProperty("aud"))if(n.aud.toLowerCase()===this.config.clientId.toLowerCase()){t={userName:"",profile:n};n.hasOwnProperty("upn")?t.userName=n.upn:n.hasOwnProperty("email")&&(t.userName=n.email)}else this.warn("IdToken has invalid aud field");return t};r.prototype._getHash=function(e){e.indexOf("#/")>-1?e=e.substring(e.indexOf("#/")+2):e.indexOf("#")>-1&&(e=e.substring(1));return e};r.prototype.isCallback=function(e){e=this._getHash(e);var t=this._deserialize(e);return t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)};r.prototype.getLoginError=function(){return this._getItem(this.CONSTANTS.STORAGE.LOGIN_ERROR)};r.prototype.getRequestInfo=function(e){e=this._getHash(e);var t=this._deserialize(e),n={valid:!1,parameters:{},stateMatch:!1,stateResponse:"",requestType:this.REQUEST_TYPE.UNKNOWN};if(t){n.parameters=t;if(t.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)||t.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)||t.hasOwnProperty(this.CONSTANTS.ID_TOKEN)){n.valid=!0;var r="";if(!t.hasOwnProperty("state")){this.warn("No state returned");return n}this.verbose("State: "+t.state);r=t.state;n.stateResponse=r;if(this._matchState(n))return n;if(!n.stateMatch&&window.parent){n.requestType=this._requestType;for(var i=this._renewStates,s=0;s<i.length;s++)if(i[s]===n.stateResponse){n.stateMatch=!0;break}}}}return n};r.prototype._matchNonce=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var n=0;n<t.length;n++)if(t[n]===e.profile.nonce)return!0}return!1};r.prototype._matchState=function(e){var t=this._getItem(this.CONSTANTS.STORAGE.STATE_LOGIN);if(t){t=t.split(this.CONSTANTS.CACHE_DELIMETER);for(var n=0;n<t.length;n++)if(t[n]===e.stateResponse){e.requestType=this.REQUEST_TYPE.LOGIN;e.stateMatch=!0;return!0}}var r=this._getItem(this.CONSTANTS.STORAGE.STATE_RENEW);if(r){r=r.split(this.CONSTANTS.CACHE_DELIMETER);for(n=0;n<r.length;n++)if(r[n]===e.stateResponse){e.requestType=this.REQUEST_TYPE.RENEW_TOKEN;e.stateMatch=!0;return!0}}return!1};r.prototype._getResourceFromState=function(e){if(e){var t=e.indexOf("|");if(t>-1&&t+1<e.length)return e.substring(t+1)}return""};r.prototype.saveTokenFromHash=function(e){this.info("State status:"+e.stateMatch+"; Request type:"+e.requestType);this._saveItem(this.CONSTANTS.STORAGE.ERROR,"");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"");var t=this._getResourceFromState(e.stateResponse);if(e.parameters.hasOwnProperty(this.CONSTANTS.ERROR_DESCRIPTION)){this.info("Error :"+e.parameters.error+"; Error description:"+e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]);this._saveItem(this.CONSTANTS.STORAGE.ERROR,e.parameters.error);this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,e.parameters[this.CONSTANTS.ERROR_DESCRIPTION]);if(e.requestType===this.REQUEST_TYPE.LOGIN){this._loginInProgress=!1;this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,e.parameters.error_description)}}else if(e.stateMatch){this.info("State is right");e.parameters.hasOwnProperty(this.CONSTANTS.SESSION_STATE)&&this._saveItem(this.CONSTANTS.STORAGE.SESSION_STATE,e.parameters[this.CONSTANTS.SESSION_STATE]);var n;if(e.parameters.hasOwnProperty(this.CONSTANTS.ACCESS_TOKEN)){this.info("Fragment has access token");if(!this._hasResource(t)){n=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"";this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,n+t+this.CONSTANTS.RESOURCE_DELIMETER)}this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,e.parameters[this.CONSTANTS.ACCESS_TOKEN]);this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,this._expiresIn(e.parameters[this.CONSTANTS.EXPIRES_IN]))}if(e.parameters.hasOwnProperty(this.CONSTANTS.ID_TOKEN)){this.info("Fragment has id token");this._loginInProgress=!1;this._user=this._createUser(e.parameters[this.CONSTANTS.ID_TOKEN]);if(this._user&&this._user.profile)if(this._matchNonce(this._user)){this._saveItem(this.CONSTANTS.STORAGE.IDTOKEN,e.parameters[this.CONSTANTS.ID_TOKEN]);t=this.config.loginResource?this.config.loginResource:this.config.clientId;if(!this._hasResource(t)){n=this._getItem(this.CONSTANTS.STORAGE.TOKEN_KEYS)||"";this._saveItem(this.CONSTANTS.STORAGE.TOKEN_KEYS,n+t+this.CONSTANTS.RESOURCE_DELIMETER)}this._saveItem(this.CONSTANTS.STORAGE.ACCESS_TOKEN_KEY+t,e.parameters[this.CONSTANTS.ID_TOKEN]);this._saveItem(this.CONSTANTS.STORAGE.EXPIRATION_KEY+t,this._user.profile.exp)}else{this._saveItem(this.CONSTANTS.STORAGE.LOGIN_ERROR,"Nonce received: "+this._user.profile.nonce+" is not same as requested: "+this._getItem(this.CONSTANTS.STORAGE.NONCE_IDTOKEN));this._user=null}else{e.parameters.error="invalid id_token";e.parameters.error_description="Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN];this._saveItem(this.CONSTANTS.STORAGE.ERROR,"invalid id_token");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid id_token. id_token: "+e.parameters[this.CONSTANTS.ID_TOKEN])}}}else{e.parameters.error="Invalid_state";e.parameters.error_description="Invalid_state. state: "+e.stateResponse;this._saveItem(this.CONSTANTS.STORAGE.ERROR,"Invalid_state");this._saveItem(this.CONSTANTS.STORAGE.ERROR_DESCRIPTION,"Invalid_state. state: "+e.stateResponse)}this._saveItem(this.CONSTANTS.STORAGE.RENEW_STATUS+t,this.CONSTANTS.TOKEN_RENEW_STATUS_COMPLETED)};r.prototype.getResourceForEndpoint=function(e){if(this.config&&this.config.anonymousEndpoints)for(var t=0;t<this.config.anonymousEndpoints.length;t++)if(e.indexOf(this.config.anonymousEndpoints[t])>-1)return null;if(this.config&&this.config.endpoints)for(var n in this.config.endpoints)if(e.indexOf(n)>-1)return this.config.endpoints[n];return e.indexOf("http://")>-1||e.indexOf("https://")>-1?this._getHostFromUri(e)===this._getHostFromUri(this.config.redirectUri)?this.config.loginResource:null:this.config.loginResource};r.prototype._getHostFromUri=function(e){var t=String(e).replace(/^(https?:)\/\//,"");return t=t.split("/")[0]};r.prototype.handleWindowCallback=function(e){null==e&&(e=window.location.hash);if(this.isCallback(e)){var t=null,n=!1;if(this._openedWindows.length>0&&this._openedWindows[this._openedWindows.length-1].opener&&this._openedWindows[this._openedWindows.length-1].opener._adalInstance){t=this._openedWindows[this._openedWindows.length-1].opener._adalInstance;n=!0}else window.parent&&window.parent._adalInstance&&(t=window.parent._adalInstance);const a=t.getRequestInfo(e);var r,i,s=null;i=n||window.parent!==window?t._callBackMappedToRenewStates[a.stateResponse]:t.callback;t.info("Returned from redirect url");t.saveTokenFromHash(a);if(a.requestType===this.REQUEST_TYPE.RENEW_TOKEN&&window.parent){window.parent!==window?t.verbose("Window is in iframe, acquiring token silently"):t.verbose("acquiring token interactive in progress");r=a.parameters[t.CONSTANTS.ACCESS_TOKEN]||a.parameters[t.CONSTANTS.ID_TOKEN];s=t.CONSTANTS.ACCESS_TOKEN}else if(a.requestType===this.REQUEST_TYPE.LOGIN){r=a.parameters[t.CONSTANTS.ID_TOKEN];s=t.CONSTANTS.ID_TOKEN}var o=a.parameters[t.CONSTANTS.ERROR_DESCRIPTION],u=a.parameters[t.CONSTANTS.ERROR];try{i&&i(o,r,u,s)}catch(e){t.error("Error occurred in user defined callback function: "+e)}if(window.parent===window&&!n){window.location.hash="";t.config.navigateToLoginRequestUrl&&(window.location.href=t._getItem(t.CONSTANTS.STORAGE.LOGIN_REQUEST))}}};r.prototype._getNavigateUrl=function(e,t){var n="common";this.config.tenant&&(n=this.config.tenant);var r=this.instance+n+"/oauth2/authorize"+this._serialize(e,this.config,t)+this._addLibMetadata();this.info("Navigate url:"+r);return r};r.prototype._extractIdToken=function(e){var t=this._decodeJwt(e);if(!t)return null;try{var n=t.JWSPayload,r=this._base64DecodeStringUrlSafe(n);if(!r){this.info("The returned id_token could not be base64 url safe decoded.");return null}return JSON.parse(r)}catch(e){this.error("The returned id_token could not be decoded",e)}return null};r.prototype._base64DecodeStringUrlSafe=function(e){e=e.replace(/-/g,"+").replace(/_/g,"/");return window.atob?decodeURIComponent(escape(window.atob(e))):decodeURIComponent(escape(this._decode(e)))};r.prototype._decode=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=(e=String(e).replace(/=+$/,"")).length;if(n%4==1)throw new Error("The token to be decoded is not correctly encoded.");for(var r,i,s,o,u,a,f,l,c="",h=0;h<n;h+=4){r=t.indexOf(e.charAt(h));i=t.indexOf(e.charAt(h+1));s=t.indexOf(e.charAt(h+2));o=t.indexOf(e.charAt(h+3));if(h+2===n-1){a=(u=r<<18|i<<12|s<<6)>>16&255;f=u>>8&255;c+=String.fromCharCode(a,f);break}if(h+1===n-1){a=(u=r<<18|i<<12)>>16&255;c+=String.fromCharCode(a);break}a=(u=r<<18|i<<12|s<<6|o)>>16&255;f=u>>8&255;l=255&u;c+=String.fromCharCode(a,f,l)}return c};r.prototype._decodeJwt=function(e){if(this._isEmpty(e))return null;var t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(e);if(!t||t.length<4){this.warn("The returned id_token is not parseable.");return null}return{header:t[1],JWSPayload:t[2],JWSSig:t[3]}};r.prototype._convertUrlSafeToRegularBase64EncodedString=function(e){return e.replace("-","+").replace("_","/")};r.prototype._serialize=function(e,t,n){var r=[];if(null!==t){r.push("?response_type="+e);r.push("client_id="+encodeURIComponent(t.clientId));n&&r.push("resource="+encodeURIComponent(n));r.push("redirect_uri="+encodeURIComponent(t.redirectUri));r.push("state="+encodeURIComponent(t.state));t.hasOwnProperty("slice")&&r.push("slice="+encodeURIComponent(t.slice));t.hasOwnProperty("extraQueryParameter")&&r.push(t.extraQueryParameter);var i=t.correlationId?t.correlationId:this._guid();r.push("client-request-id="+encodeURIComponent(i))}return r.join("&")};r.prototype._deserialize=function(e){var t,n=/\+/g,r=/([^&=]+)=([^&]*)/g,i=function(e){return decodeURIComponent(e.replace(n," "))},s={};t=r.exec(e);for(;t;){s[i(t[1])]=i(t[2]);t=r.exec(e)}return s};r.prototype._decimalToHex=function(e){for(var t=e.toString(16);t.length<2;)t="0"+t;return t};r.prototype._guid=function(){var e=window.crypto||window.msCrypto;if(e&&e.getRandomValues){var t=new Uint8Array(16);e.getRandomValues(t);t[6]|=64;t[6]&=79;t[8]|=128;t[8]&=191;return this._decimalToHex(t[0])+this._decimalToHex(t[1])+this._decimalToHex(t[2])+this._decimalToHex(t[3])+"-"+this._decimalToHex(t[4])+this._decimalToHex(t[5])+"-"+this._decimalToHex(t[6])+this._decimalToHex(t[7])+"-"+this._decimalToHex(t[8])+this._decimalToHex(t[9])+"-"+this._decimalToHex(t[10])+this._decimalToHex(t[11])+this._decimalToHex(t[12])+this._decimalToHex(t[13])+this._decimalToHex(t[14])+this._decimalToHex(t[15])}for(var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef",i=0,s="",o=0;o<36;o++){"-"!==n[o]&&"4"!==n[o]&&(i=16*Math.random()|0);if("x"===n[o])s+=r[i];else if("y"===n[o]){i&=3;s+=r[i|=8]}else s+=n[o]}return s};r.prototype._expiresIn=function(e){e||(e=3599);return this._now()+parseInt(e,10)};r.prototype._now=function(){return Math.round((new Date).getTime()/1e3)};r.prototype._addAdalFrame=function(e){if(void 0!==e){this.info("Add adal frame to document:"+e);var t=document.getElementById(e);if(!t){if(document.createElement&&document.documentElement&&(window.opera||-1===window.navigator.userAgent.indexOf("MSIE 5.0"))){var n=document.createElement("iframe");n.setAttribute("id",e);n.setAttribute("aria-hidden","true");n.style.visibility="hidden";n.style.position="absolute";n.style.width=n.style.height=n.borderWidth="0px";t=document.getElementsByTagName("body")[0].appendChild(n)}else document.body&&document.body.insertAdjacentHTML&&document.body.insertAdjacentHTML("beforeEnd",'<iframe name="'+e+'" id="'+e+'" style="display:none"></iframe>');window.frames&&window.frames[e]&&(t=window.frames[e])}return t}};r.prototype._saveItem=function(e,t,n){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage()){this.info("Local storage is not supported");return!1}if(n){var r=this._getItem(e)||"";localStorage.setItem(e,r+t+this.CONSTANTS.CACHE_DELIMETER)}else localStorage.setItem(e,t);return!0}if(!this._supportsSessionStorage()){this.info("Session storage is not supported");return!1}sessionStorage.setItem(e,t);return!0};r.prototype._getItem=function(e){if(this.config&&this.config.cacheLocation&&"localStorage"===this.config.cacheLocation){if(!this._supportsLocalStorage()){this.info("Local storage is not supported");return null}return localStorage.getItem(e)}if(!this._supportsSessionStorage()){this.info("Session storage is not supported");return null}return sessionStorage.getItem(e)};r.prototype._supportsLocalStorage=function(){try{if(!window.localStorage)return!1;window.localStorage.setItem("storageTest","A");if("A"!=window.localStorage.getItem("storageTest"))return!1;window.localStorage.removeItem("storageTest");return!window.localStorage.getItem("storageTest")}catch(e){return!1}};r.prototype._supportsSessionStorage=function(){try{if(!window.sessionStorage)return!1;window.sessionStorage.setItem("storageTest","A");if("A"!=window.sessionStorage.getItem("storageTest"))return!1;window.sessionStorage.removeItem("storageTest");return!window.sessionStorage.getItem("storageTest")}catch(e){return!1}};r.prototype._cloneConfig=function(e){if(null===e||"object"!=typeof e)return e;var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};r.prototype._addLibMetadata=function(){return"&x-client-SKU=Js&x-client-Ver="+this._libVersion()};r.prototype.log=function(e,t,n){if(e<=Logging.level){var r=(new Date).toUTCString(),i="";i=this.config.correlationId?r+":"+this.config.correlationId+"-"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t:r+":"+this._libVersion()+"-"+this.CONSTANTS.LEVEL_STRING_MAP[e]+" "+t;n&&(i+="\nstack:\n"+n.stack);Logging.log(i)}};r.prototype.error=function(e,t){this.log(this.CONSTANTS.LOGGING_LEVEL.ERROR,e,t)};r.prototype.warn=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.WARN,e,null)};r.prototype.info=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.INFO,e,null)};r.prototype.verbose=function(e){this.log(this.CONSTANTS.LOGGING_LEVEL.VERBOSE,e,null)};r.prototype._libVersion=function(){return"1.0.16"};if(e.exports){e.exports=r;e.exports.inject=function(e){return new r(e)}}return r})()}}]);